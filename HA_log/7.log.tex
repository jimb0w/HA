. gen MI = 1 if substr(diag1,1,3)=="I21"
(3 missing values generated)
{\smallskip}
. gen DM2= 1 if substr(diag1,1,3)=="E11" | substr(diag2,1,3)=="E11"
(1 missing value generated)
{\smallskip}
. gen other_arr= 1 if substr(diag1,1,3)=="I49" | substr(diag2,1,3)=="I49"
(5 missing values generated)
{\smallskip}
. *Note in this example we are not interested in pneumonia, so we don't collect that. 
. forval i = 1/6 {\lbr}
  2. bysort id (admdate sepdate) : gen nest = 1 if admdate < sepdate[_n-1] \& sepdate[_n-1]!=.
  3. bysort id (admdate sepdate) : replace nest =. if nest[_n-1]==1
  4. bysort id (admdate sepdate) : replace MI = 1 if MI[_n+1] == 1 \& nest[_n+1] == 1
  5. bysort id (admdate sepdate) : replace DM2 = 1 if DM2[_n+1] == 1 \& nest[_n+1] == 1
  6. bysort id (admdate sepdate) : replace other_arr = 1 if other_arr[_n+1] == 1 \& nest[_n+1] == 1
  7. bysort id (admdate sepdate) : replace sepdate = sepdate[_n+1] if sepdate[_n+1] > sepdate \& nest
> [_n+1] == 1
  8. list, separator(0)
  9. drop if nest == 1
 10. drop nest
 11. {\rbr}
(5 missing values generated)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
(0 real changes made)
{\smallskip}
     {\TLC}\HLI{73}{\TRC}
     {\VBAR} id     admdate     sepdate   diag1   diag2   MI   DM2   other_{\tytilde}r   nest {\VBAR}
     {\LFTT}\HLI{73}{\RGTT}
  1. {\VBAR}  1   01jan2020   08jan2020    I214            1     1          .      . {\VBAR}
  2. {\VBAR}  1   02jan2020   02jan2020    I214    E119    1     1          .      1 {\VBAR}
  3. {\VBAR}  1   03jan2020   03jan2020    I499    E119    .     1          1      . {\VBAR}
  4. {\VBAR}  1   05jan2020   05jan2020    J152    E119    .     1          .      . {\VBAR}
  5. {\VBAR}  1   06jan2020   12jan2020    I214    E119    1     1          .      . {\VBAR}
  6. {\VBAR}  1   15jul2020   15jul2020    I509    E119    .     1          .      . {\VBAR}
     {\BLC}\HLI{73}{\BRC}
(1 observation deleted)
(4 missing values generated)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)
{\smallskip}
     {\TLC}\HLI{73}{\TRC}
     {\VBAR} id     admdate     sepdate   diag1   diag2   MI   DM2   other_{\tytilde}r   nest {\VBAR}
     {\LFTT}\HLI{73}{\RGTT}
  1. {\VBAR}  1   01jan2020   08jan2020    I214            1     1          1      . {\VBAR}
  2. {\VBAR}  1   03jan2020   03jan2020    I499    E119    .     1          1      1 {\VBAR}
  3. {\VBAR}  1   05jan2020   05jan2020    J152    E119    .     1          .      . {\VBAR}
  4. {\VBAR}  1   06jan2020   12jan2020    I214    E119    1     1          .      . {\VBAR}
  5. {\VBAR}  1   15jul2020   15jul2020    I509    E119    .     1          .      . {\VBAR}
     {\BLC}\HLI{73}{\BRC}
(1 observation deleted)
(3 missing values generated)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
{\smallskip}
     {\TLC}\HLI{73}{\TRC}
     {\VBAR} id     admdate     sepdate   diag1   diag2   MI   DM2   other_{\tytilde}r   nest {\VBAR}
     {\LFTT}\HLI{73}{\RGTT}
  1. {\VBAR}  1   01jan2020   08jan2020    I214            1     1          1      . {\VBAR}
  2. {\VBAR}  1   05jan2020   05jan2020    J152    E119    .     1          .      1 {\VBAR}
  3. {\VBAR}  1   06jan2020   12jan2020    I214    E119    1     1          .      . {\VBAR}
  4. {\VBAR}  1   15jul2020   15jul2020    I509    E119    .     1          .      . {\VBAR}
     {\BLC}\HLI{73}{\BRC}
(1 observation deleted)
(2 missing values generated)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
{\smallskip}
     {\TLC}\HLI{73}{\TRC}
     {\VBAR} id     admdate     sepdate   diag1   diag2   MI   DM2   other_{\tytilde}r   nest {\VBAR}
     {\LFTT}\HLI{73}{\RGTT}
  1. {\VBAR}  1   01jan2020   12jan2020    I214            1     1          1      . {\VBAR}
  2. {\VBAR}  1   06jan2020   12jan2020    I214    E119    1     1          .      1 {\VBAR}
  3. {\VBAR}  1   15jul2020   15jul2020    I509    E119    .     1          .      . {\VBAR}
     {\BLC}\HLI{73}{\BRC}
(1 observation deleted)
(2 missing values generated)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
{\smallskip}
     {\TLC}\HLI{73}{\TRC}
     {\VBAR} id     admdate     sepdate   diag1   diag2   MI   DM2   other_{\tytilde}r   nest {\VBAR}
     {\LFTT}\HLI{73}{\RGTT}
  1. {\VBAR}  1   01jan2020   12jan2020    I214            1     1          1      . {\VBAR}
  2. {\VBAR}  1   15jul2020   15jul2020    I509    E119    .     1          .      . {\VBAR}
     {\BLC}\HLI{73}{\BRC}
(0 observations deleted)
(2 missing values generated)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
{\smallskip}
     {\TLC}\HLI{73}{\TRC}
     {\VBAR} id     admdate     sepdate   diag1   diag2   MI   DM2   other_{\tytilde}r   nest {\VBAR}
     {\LFTT}\HLI{73}{\RGTT}
  1. {\VBAR}  1   01jan2020   12jan2020    I214            1     1          1      . {\VBAR}
  2. {\VBAR}  1   15jul2020   15jul2020    I509    E119    .     1          .      . {\VBAR}
     {\BLC}\HLI{73}{\BRC}
(0 observations deleted)
{\smallskip}
