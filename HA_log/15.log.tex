. use HESIN_DIAG, clear
{\smallskip}
. *Only keep primary diagnoses
. keep if level == 1
(12,953,647 observations deleted)
{\smallskip}
. ta arr_index
{\smallskip}
  arr_index {\VBAR}      Freq.     Percent        Cum.
\HLI{12}{\PLUS}\HLI{35}
          0 {\VBAR}  4,149,189      100.00      100.00
\HLI{12}{\PLUS}\HLI{35}
      Total {\VBAR}  4,149,189      100.00
{\smallskip}
. *Generate a variable that will tag diagnoses that define MI and then drop everything else
. gen MI = 1 if inrange(diag,"I21","I229")
(4,116,019 missing values generated)
{\smallskip}
. keep if MI == 1
(4,116,019 observations deleted)
{\smallskip}
. save hesinmi, replace
file{\bftt{ hesinmi.dta}} saved
{\smallskip}
. use HESIN, clear
{\smallskip}
. merge 1:m eid ins_index using hesinmi
{\smallskip}
    Result                      Number of obs
    \HLI{41}
    Not matched                     4,142,808
        from master                 4,142,808  (_merge==1)
        from using                          0  (_merge==2)
{\smallskip}
    Matched                            33,170  (_merge==3)
    \HLI{41}
{\smallskip}
. *Of the more than 4,000,000 episodes, we have 33,170 where MI is coded as the primary diagnosis.
